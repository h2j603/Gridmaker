<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>고급 반응형 그리드 시스템</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; }
.container { max-width: 1800px; margin: 0 auto; background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 20px rgba(0,0,0,0.08); }
.header { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb; }
.header h1 { color: #111827; font-size: 2em; margin-bottom: 8px; }
.view-toggle { display: flex; gap: 8px; margin-bottom: 20px; }
.view-btn { padding: 10px 20px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; font-weight: 500; transition: all 0.2s; }
.view-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
.workspace { display: grid; grid-template-columns: 320px 1fr 400px; gap: 30px; }
.panel { background: #f9fafb; border-radius: 8px; padding: 20px; }
.panel h3 { color: #111827; font-size: 0.95em; margin-bottom: 16px; font-weight: 600; }
.control-group { margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid #e5e7eb; }
.control-group:last-child { border-bottom: none; }
.control-label { display: block; color: #374151; font-size: 0.85em; font-weight: 500; margin-bottom: 6px; }
.control-input { width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
.input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
.btn { width: 100%; padding: 10px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; margin-bottom: 8px; font-size: 14px; }
.btn-primary { background: #3b82f6; color: white; }
.btn-primary:hover { background: #2563eb; }
.btn-secondary { background: #e5e7eb; color: #374151; }

/* --- [수정] 배율(scale)을 위한 transform-origin 추가 --- */
.canvas { 
  background: whitesmoke; border-radius: 8px; padding: 20px; min-height: 600px; 
  transition: all 0.3s;
  transform-origin: top center; /* 배율 변경 기준점 */
}
/* ---------------------------------------------------- */

.canvas.mobile-view { max-width: 375px; margin: 0 auto; }
.grid-container { display: grid; gap: 10px; min-height: 500px; }
.module { background: #8c6c3c; border-radius: 0; min-height: 60px; cursor: pointer; position: relative; border: 2px solid transparent; transition: all 0.2s; }
.module:hover { border-color: #3b82f6; transform: translateY(-2px); }
.module.selected { border-color: #ef4444; border-width: 3px; }
.module.dragging { opacity: 0.5; }
.module.warning { border-color: #f59e0b; border-width: 2px; }
.module-info { position: absolute; top: 4px; left: 4px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; }
.module-warning { position: absolute; top: 4px; right: 28px; background: rgba(245, 158, 11, 0.9); color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; }
.module-delete { position: absolute; top: 4px; right: 4px; width: 20px; height: 20px; background: rgba(239, 68, 68, 0.9); color: white; border: none; border-radius: 50%; cursor: pointer; display: none; font-size: 14px; }
.module:hover .module-delete { display: block; }
.module-drag-handle { position: absolute; bottom: 4px; right: 4px; width: 24px; height: 24px; background: rgba(0,0,0,0.5); color: white; border-radius: 4px; cursor: move; display: none; justify-content: center; align-items: center; font-size: 16px; line-height: 1; padding-bottom: 2px; }
.module:hover .module-drag-handle { display: flex; }
.stats { background: #eff6ff; padding: 12px; border-radius: 6px; margin-bottom: 16px; }
.stats-item { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.85em; }
.mode-selector { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
.mode-option { padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; transition: all 0.2s; background: white; }
.mode-option:hover { border-color: #3b82f6; }
.mode-option.selected { border-color: #3b82f6; background: #eff6ff; }
.mode-option-title { font-weight: 600; font-size: 0.9em; margin-bottom: 4px; }
.mode-option-desc { font-size: 0.75em; color: #6b7280; }
.custom-offset { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
.mode-hint { font-size: 0.75em; color: #6b7280; margin-top: 6px; padding: 8px; background: #f0f9ff; border-radius: 4px; }
.hint-text { font-size: 0.75em; color: #6b7280; margin-top: 4px; }
.lock-toggle { display: flex; align-items: center; gap: 8px; background: #f0f9ff; padding: 10px; border-radius: 6px; margin-top: 12px; }
.lock-toggle label { margin-bottom: 0; font-size: 0.9em; font-weight: 500; }
.code-tabs { display: flex; gap: 8px; margin-bottom: 12px; border-bottom: 2px solid #e5e7eb; }
.code-tab { padding: 8px 16px; background: transparent; border: none; color: #6b7280; cursor: pointer; font-weight: 500; border-bottom: 2px solid transparent; margin-bottom: -2px; }
.code-tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
.code-display { background: #1e293b; color: #e2e8f0; padding: 16px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6; max-height: 500px; overflow-y: auto; white-space: pre; }
.toast { position: fixed; bottom: 20px; right: 20px; background: #111827; color: white; padding: 12px 20px; border-radius: 8px; z-index: 1000; }

/* --- [삭제] 1400px 이하일 때 2단으로 바뀌는 규칙 제거 --- */
/*
@media (max-width: 1400px) { 
  .workspace { 
    grid-template-columns: 320px 1fr; 
  }
  .workspace > .panel:last-of-type { 
    grid-column: 1 / -1; 
  }
}
*/

/* --- [수정] 768px 이하일 때 레이아웃 변경 규칙만 제거 --- */
@media (max-width: 768px) {
  /*
  .workspace {
    grid-template-columns: 1fr; 
  }
  .workspace > .panel:last-of-type { 
    grid-column: auto; 
  }
  */
  body { padding: 10px; }
  .container { padding: 15px; }
  .workspace { gap: 15px; }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>📐 고급 반응형 그리드 시스템</h1>
    <p>비율 기반 자동 변환 + 수동 조정 가능</p>
  </div>

  <div class="view-toggle">
    <button class="view-btn active" onclick="switchView('desktop')">🖥️ 데스크톱</button>
    <button class="view-btn" onclick="switchView('mobile')">📱 모바일 프리뷰</button>
  </div>

  <div class="workspace">
    <div class="panel">
      <div class="control-group">
        <h3>📊 데스크톱 설정</h3>
        <div class="stats">
          <div class="stats-item"><span>컬럼</span><span id="stat-columns">6개</span></div>
          <div class="stats-item"><span>갭</span><span id="stat-gap">10px</span></div>
          <div class="stats-item"><span>모듈</span><span id="stat-modules">0개</span></div>
        </div>
        <label class="control-label">컬럼 수</label>
        <input type="number" id="columns" class="control-input" min="1" max="12" value="6">
        <label class="control-label" style="margin-top: 12px">갭 크기 (px)</label>
        <input type="number" id="gap" class="control-input" min="0" max="50" value="10">
        
        <label class="control-label" style="margin-top: 12px">캔버스 배율</label>
        <div style="display: flex; align-items: center; gap: 10px;">
          <input type="range" id="canvas-scale" class="control-input" min="25" max="150" value="100" style="flex-grow: 1; padding: 0;">
          <span id="scale-readout" style="font-size: 0.9em; width: 45px; text-align: right;">100%</span>
        </div>
        </div>

      <div class="control-group">
        <h3>➕ 커스텀 모듈 추가</h3>
        <div class="input-group">
          <input type="number" id="custom-col" class="control-input" placeholder="컬럼" min="1" value="2">
          <input type="number" id="custom-row" class="control-input" placeholder="로우" min="1" value="2">
        </div>
        <label class="control-label" style="margin-top: 8px">배경색</label>
        <input type="color" id="custom-color" class="control-input" value="#8c6c3c" style="height: 40px; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
          <input type="checkbox" id="custom-transparent" onchange="toggleColorPicker('custom', this.checked)">
          <label for="custom-transparent" style="font-size: 0.85em;">배경 투명</label>
        </div>
        <label class="control-label" style="margin-top: 12px">윤곽선 색</label>
        <input type="color" id="custom-border-color" class="control-input" value="#000000" style="height: 40px; cursor: pointer;">
        <label class="control-label" style="margin-top: 12px">윤곽선 두께 (px)</label>
        <input type="number" id="custom-border-width" class="control-input" value="0" min="0" max="20">
        <button class="btn btn-primary" onclick="addCustomModule()" style="margin-top: 12px">모듈 추가</button>
      </div>

      <div class="control-group" id="edit-panel" style="display: none;">
        <h3>✏️ 모듈 편집</h3>
        <label class="control-label">데스크톱 컬럼 span</label>
        <input type="number" id="edit-col" class="control-input" min="1" max="12">
        <label class="control-label" style="margin-top: 12px">데스크톱 로우 span</label>
        <input type="number" id="edit-row" class="control-input" min="1" max="10">
        <label class="control-label" style="margin-top: 12px">모바일 컬럼 span (선택)</label>
        <input type="number" id="edit-mobile-col" class="control-input" min="1" max="12" placeholder="비워두면 자동">
        <div class="hint-text" id="mobile-span-hint">자동: 비율 계산</div>
        <label class="control-label" style="margin-top: 12px">배경색</label>
        <input type="color" id="edit-color" class="control-input" style="height: 40px; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
          <input type="checkbox" id="edit-transparent" onchange="toggleColorPicker('edit', this.checked)">
          <label for="edit-transparent" style="font-size: 0.85em;">배경 투명</label>
        </div>
        <label class="control-label" style="margin-top: 12px">윤곽선 색</label>
        <input type="color" id="edit-border-color" class="control-input" style="height: 40px; cursor: pointer;">
        <label class="control-label" style="margin-top: 12px">윤곽선 두께 (px)</label>
        <input type="number" id="edit-border-width" class="control-input" value="0" min="0" max="20">
        <button class="btn btn-secondary" style="margin-top: 12px" onclick="deleteSelected()">🗑️ 삭제</button>
      </div>

      <div class="control-group">
        <h3>📱 모바일 반응형 모드</h3>
        <label class="control-label">모바일 목표 컬럼 수</label>
        <input type="number" id="target-columns" class="control-input" min="1" max="12" value="2">
        <div class="lock-toggle">
          <input type="checkbox" id="mobile-order-lock" onchange="toggleMobileOrderLock(event)">
          <label for="mobile-order-lock">🔒 모바일 순서 동기화</label>
        </div>
        <label class="control-label" style="margin-top: 12px">변환 모드</label>
        <div class="mode-selector">
          <div class="mode-option selected" onclick="selectMode('reflow')" data-mode="reflow">
            <div class="mode-option-title">🔄 리플로우</div>
            <div class="mode-option-desc">순서대로 재배치</div>
          </div>
          <div class="mode-option" onclick="selectMode('center')" data-mode="center" style="opacity: 0.5; cursor: not-allowed;">
            <div class="mode-option-title">⬅️➡️ 중앙 유지 (비활성)</div>
            <div class="mode-option-desc">양끝 균등 제거</div>
          </div>
        </div>
        <div class="mode-hint" id="mode-hint">6열 → 2열로 리플로우</div>
      </div>

      <div class="control-group">
        <button class="btn btn-secondary" onclick="clearAll()">🗑️ 전체 삭제</button>
      </div>
    </div>

    <div class="canvas" id="canvas" onclick="handleCanvasClick(event)">
      <div class="grid-container" id="grid"></div>
    </div>

    <div class="panel">
      <h3>💻 생성된 코드</h3>
      <div class="code-tabs">
        <button class="code-tab active" onclick="switchTab('html', event)">HTML</button>
        <button class="code-tab" onclick="switchTab('css', event)">CSS</button>
      </div>
      <div class="code-display" id="code-display"></div>
      <button class="btn btn-primary" style="margin-top: 12px" onclick="copyCode()">📋 클립보드에 복사</button>
    </div>
  </div>
</div>

<div id="toast" class="toast" style="display: none;"></div>

<script>
let modules = [];
let desktopColumns = 6, desktopGap = 10;
let targetColumns = 2, mobileGap = 10;
let responsiveMode = 'reflow';
let currentView = 'desktop', selectedModule = null, activeTab = 'html', draggedIndex = null;
let desktopOrder = [], mobileOrder = [];
let mobileOrderLocked = false;

function toggleColorPicker(prefix, isTransparent) {
  const colorInput = document.getElementById(prefix + '-color');
  colorInput.disabled = isTransparent;
  colorInput.style.opacity = isTransparent ? 0.5 : 1;
  if (prefix === 'edit' && selectedModule !== null) {
    modules[selectedModule].transparent = isTransparent;
    render();
  }
}

function calculateMobileSpan(desktopCol, desktopCols, targetCols) {
  const ratio = desktopCol / desktopCols;
  const calculated = Math.round(ratio * targetCols);
  return Math.max(1, Math.min(calculated, targetCols));
}

function getMobileSpan(module) {
  const clampedTarget = Math.min(module.mobileCol, targetColumns);
  if(module.mobileCol !== undefined && module.mobileCol !== null && module.mobileCol !== '') {
    return Math.max(1, clampedTarget);
  }
  return calculateMobileSpan(module.col, desktopColumns, targetColumns);
}

function switchView(view) {
  currentView = view;
  document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('canvas').classList.toggle('mobile-view', view === 'mobile');
  deselectModule();
  render();
}

function selectMode(mode) {
  if (mode !== 'reflow') {
    showToast('이 모드는 현재 아키텍처에서 지원되지 않습니다.');
    return;
  }
  responsiveMode = mode;
  document.querySelectorAll('.mode-option').forEach(opt => opt.classList.remove('selected'));
  document.querySelector(`[data-mode="${mode}"]`).classList.add('selected');
  updateModeHint();
  updateCode();
  showToast(getModeLabel(mode) + ' 모드');
}

function getModeLabel(mode) {
  return {'reflow':'리플로우','center':'중앙 유지','left':'왼쪽 유지','right':'오른쪽 유지','custom':'커스텀'}[mode];
}

function updateModeHint() {
  const hint = document.getElementById('mode-hint');
  hint.textContent = `${desktopColumns}열 → ${targetColumns}열로 리플로우`;
}

function updateMobileSpanHint() {
  if(selectedModule === null) return;
  const m = modules[selectedModule];
  const auto = calculateMobileSpan(m.col, desktopColumns, targetColumns);
  const hint = document.getElementById('mobile-span-hint');
  hint.textContent = `자동: ${auto}열 (${m.col}/${desktopColumns} × ${targetColumns})`;
}

function clamp(value, min, max) {
  return Math.max(min, Math.min(value, max));
}

function toggleMobileOrderLock(event) {
  mobileOrderLocked = event.target.checked;
  if (mobileOrderLocked) {
    mobileOrder = [...desktopOrder];
    showToast('모바일 순서가 데스크톱에 동기화됩니다.');
    render();
  } else {
    showToast('모바일 순F서 동기화 해제');
  }
}

function init() {
  document.getElementById('columns').addEventListener('input', e => { 
    desktopColumns = clamp(parseInt(e.target.value) || 1, 1, 12);
    updateStats(); updateModeHint(); updateMobileSpanHint(); render(); 
  });
  document.getElementById('gap').addEventListener('input', e => { 
    desktopGap = clamp(parseInt(e.target.value) || 0, 0, 50);
    updateStats(); render(); 
  });
  document.getElementById('target-columns').addEventListener('input', e => { 
    targetColumns = clamp(parseInt(e.target.value) || 1, 1, 12); 
    updateModeHint(); updateMobileSpanHint(); updateCode(); render();
  });
  
  // --- [신규] 캔버스 배율 슬라이더 리스너 ---
  document.getElementById('canvas-scale').addEventListener('input', e => {
    const scaleValue = parseInt(e.target.value);
    document.getElementById('canvas').style.transform = `scale(${scaleValue / 100})`;
    document.getElementById('scale-readout').textContent = `${scaleValue}%`;
  });
  // ----------------------------------------

  // 모듈 편집 리스너
  document.getElementById('edit-col').addEventListener('input', e => { 
    if(selectedModule!==null) { 
      const maxCol = desktopColumns;
      modules[selectedModule].col = clamp(parseInt(e.target.value)||1, 1, maxCol);
      e.target.value = modules[selectedModule].col; 
      updateMobileSpanHint();
      render(); 
    }
  });
  document.getElementById('edit-row').addEventListener('input', e => { 
    if(selectedModule!==null) { 
      modules[selectedModule].row = clamp(parseInt(e.target.value)||1, 1, 99);
      e.target.value = modules[selectedModule].row;
      render(); 
    }});
  document.getElementById('edit-mobile-col').addEventListener('input', e => { 
    if(selectedModule!==null) { 
      const val = e.target.value;
      if (val === '') {
        modules[selectedModule].mobileCol = null;
      } else {
        const maxCol = targetColumns;
        modules[selectedModule].mobileCol = clamp(parseInt(val)||1, 1, maxCol);
        e.target.value = modules[selectedModule].mobileCol;
      }
      render(); 
    }
  });
  document.getElementById('edit-color').addEventListener('input', e => { 
      if(selectedModule!==null) { modules[selectedModule].color = e.target.value; render(); }
  });
  document.getElementById('edit-border-color').addEventListener('input', e => { 
    if(selectedModule!==null) { modules[selectedModule].borderColor = e.target.value; render(); }
  });
  document.getElementById('edit-border-width').addEventListener('input', e => { 
    if(selectedModule!==null) { 
      modules[selectedModule].borderWidth = clamp(parseInt(e.target.value) || 0, 0, 20);
      e.target.value = modules[selectedModule].borderWidth;
      render(); 
    }
  });

  updateStats(); updateModeHint(); render();
}

function addCustomModule() {
  const col = clamp(parseInt(document.getElementById('custom-col').value) || 2, 1, desktopColumns);
  const row = clamp(parseInt(document.getElementById('custom-row').value) || 2, 1, 99);
  const color = document.getElementById('custom-color').value;
  const transparent = document.getElementById('custom-transparent').checked;
  const borderColor = document.getElementById('custom-border-color').value;
  const borderWidth = clamp(parseInt(document.getElementById('custom-border-width').value) || 0, 0, 20);

  const newModule = { 
    col, row, color, transparent, borderColor, borderWidth, 
    mobileCol: null, id: Date.now() 
  };
  
  modules.push(newModule);
  desktopOrder.push(newModule.id);
  
  if (mobileOrderLocked) {
    mobileOrder.push(newModule.id);
  } else {
    mobileOrder.push(newModule.id);
  }
  
  document.getElementById('custom-transparent').checked = false;
  toggleColorPicker('custom', false);
  document.getElementById('custom-border-width').value = 0;

  showToast(`${col}×${row} 모듈 추가`);
  render();
}

function selectModule(index) {
  selectedModule = index;
  const m = modules[index];
  document.getElementById('edit-panel').style.display = 'block';
  
  document.getElementById('edit-col').value = clamp(m.col, 1, desktopColumns);
  document.getElementById('edit-col').max = desktopColumns;
  document.getElementById('edit-row').value = m.row;
  document.getElementById('edit-mobile-col').value = m.mobileCol !== null ? clamp(m.mobileCol, 1, targetColumns) : '';
  document.getElementById('edit-mobile-col').max = targetColumns;
  
  document.getElementById('edit-color').value = m.color || '#8c6c3c';
  const isTransparent = m.transparent || false;
  document.getElementById('edit-transparent').checked = isTransparent;
  toggleColorPicker('edit', isTransparent);
  
  document.getElementById('edit-border-color').value = m.borderColor || '#000000';
  document.getElementById('edit-border-width').value = m.borderWidth || 0;
  
  updateMobileSpanHint();
  render();
}

function handleCanvasClick(event) {
  if (event.target.id === 'canvas' || event.target.id === 'grid') {
    deselectModule();
  }
}

function deselectModule() {
  if (selectedModule !== null) {
    selectedModule = null;
    document.getElementById('edit-panel').style.display = 'none';
    render();
  }
}

function deleteSelected() {
  if(selectedModule !== null) {
    deleteModule(selectedModule, new Event('click')); 
  }
}

function deleteModule(index, event) {
  event.stopPropagation();
  const id = modules[index].id;
  modules.splice(index, 1);
  desktopOrder = desktopOrder.filter(oid => oid !== id);
  mobileOrder = mobileOrder.filter(oid => oid !== id);

  if(selectedModule === index) {
    selectedModule = null;
    document.getElementById('edit-panel').style.display = 'none';
  } else if(selectedModule > index) {
    selectedModule--;
  }
  render();
}

function clearAll() {
  if(confirm('모든 모듈을 삭제하시겠습니까?')) {
    modules = [];
    desktopOrder = [];
    mobileOrder = [];
    selectedModule = null;
    document.getElementById('edit-panel').style.display = 'none';
    showToast('전체 삭제');
    render();
  }
}

function handleDragStart(index, event) {
  draggedIndex = index;
  event.target.closest('.module').classList.add('dragging');
  event.dataTransfer.effectAllowed = 'move';
}

function handleDragEnd(event) {
  document.querySelectorAll('.module.dragging').forEach(el => el.classList.remove('dragging'));
  draggedIndex = null;
}

function handleDragOver(event) {
  event.preventDefault();
  event.dataTransfer.dropEffect = 'move';
}

function handleDrop(index, event) {
  event.preventDefault();
  event.stopPropagation();
  
  if(draggedIndex !== null && draggedIndex !== index) {
    const order = currentView === 'desktop' ? desktopOrder : mobileOrder;
    const draggedId = order[draggedIndex];
    order.splice(draggedIndex, 1);
    order.splice(index, 0, draggedId);
    
    if (currentView === 'desktop' && mobileOrderLocked) {
      mobileOrder = [...desktopOrder];
    }
    
    if (selectedModule !== null) {
        const selectedId = modules[selectedModule].id;
        const actualIndex = modules.findIndex(m => m.id === selectedId);
        selectedModule = actualIndex;
    }
    
    render();
  }
  draggedIndex = null;
}

function getOrderedModules() {
  const order = currentView === 'desktop' ? desktopOrder : mobileOrder;
  return order.map(id => modules.find(m => m.id === id)).filter(m => m);
}

function updateStats() {
  document.getElementById('stat-columns').textContent = `${desktopColumns}개`;
  document.getElementById('stat-gap').textContent = `${desktopGap}px`;
  document.getElementById('stat-modules').textContent = `${modules.length}개`;
}

function render() {
  const grid = document.getElementById('grid');
  const columns = currentView === 'desktop' ? desktopColumns : targetColumns;
  const gap = currentView === 'desktop' ? desktopGap : mobileGap;
  grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
  grid.style.gap = `${gap}px`;
  
  const orderedModules = getOrderedModules();
  
  grid.innerHTML = orderedModules.map((m, i) => {
    const actualIndex = modules.findIndex(mod => mod.id === m.id);
    if (actualIndex === -1) return ''; 
    
    const isTransparent = m.transparent || false;
    const bgColor = isTransparent ? 'transparent' : (m.color || '#8c6c3c');
    const borderWidth = m.borderWidth || 0;
    const borderColor = m.borderColor || '#000000';
    const outlineStyle = borderWidth > 0 ? `outline: ${borderWidth}px solid ${borderColor}; outline-offset: -${borderWidth}px;` : '';
    
    const desktopColSpan = clamp(m.col, 1, desktopColumns);
    const mobileColSpan = getMobileSpan(m);
    const col = currentView === 'desktop' ? desktopColSpan : mobileColSpan;
    
    const showWarning = currentView === 'mobile' && 
                        m.col > targetColumns && 
                        (m.mobileCol === null || m.mobileCol === undefined || m.mobileCol === '');
    
    return `
    <div class="module ${selectedModule === actualIndex ? 'selected' : ''} ${showWarning ? 'warning' : ''}" 
         style="grid-column: span ${col}; grid-row: span ${m.row}; background: ${bgColor}; ${outlineStyle}"
         onclick="selectModule(${actualIndex})"
         ondragover="handleDragOver(event)"
         ondrop="handleDrop(${i}, event)">
      <div class="module-info">${m.col}×${m.row}</div>
      ${showWarning ? '<div class="module-warning">!</div>' : ''}
      <button class="module-delete" onclick="deleteModule(${actualIndex}, event)">×</button>
      <div class="module-drag-handle" 
           draggable="true" 
           ondragstart="handleDragStart(${i}, event)" 
           ondragend="handleDragEnd(event)">⠿</div>
    </div>
  `}).join('');
  updateStats(); updateCode();
}

function generateHTML() {
  return `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="grid-container">
${desktopOrder.map((id, i) => {
    const m = modules.find(mod => mod.id === id);
    if (!m) return '';
    return `    <div class="module module-${i + 1}"></div>`;
  }).join('\n')}
  </div>
</body>
</html>`;
}

function generateCSS() {
  let css = `body {
  margin: 0;
  background: whitesmoke;
  padding: ${desktopGap}px;
}

.grid-container {
  display: grid;
  grid-template-columns: repeat(${desktopColumns}, 1fr);
  gap: ${desktopGap}px;
}

.module {
  min-height: 60px;
}

${desktopOrder.map((id, i) => {
  const m = modules.find(mod => mod.id === id);
  if (!m) return '';
  const desktopColSpan = clamp(m.col, 1, desktopColumns);
  
  const isTransparent = m.transparent || false;
  const bgColor = isTransparent ? 'transparent' : (m.color || '#8c6c3c');
  const borderWidth = m.borderWidth || 0;
  const borderColor = m.borderColor || '#000000';
  const outlineStyle = borderWidth > 0 ? `\n  outline: ${borderWidth}px solid ${borderColor};\n  outline-offset: -${borderWidth}px;` : '';

  return `.module-${i + 1} {
  grid-column: span ${desktopColSpan};
  grid-row: span ${m.row};
  background: ${bgColor};${outlineStyle}
}`;
}).join('\n\n')}

/* 모바일 반응형 - ${getModeLabel(responsiveMode)} */
@media (max-width: 768px) {
  body { padding: ${mobileGap}px; }
  .grid-container {
    grid-template-columns: repeat(${targetColumns}, 1fr);
    gap: ${mobileGap}px;
  }
  
`;

  if(responsiveMode === 'reflow') {
      css += mobileOrder.map((id, i) => {
      const m = modules.find(mod => mod.id === id);
      if (!m) return '';
      const moduleClassIndex = desktopOrder.indexOf(id) + 1;
      if (moduleClassIndex === 0) return ''; 

      const mobileSpan = getMobileSpan(m);
      const comment = m.mobileCol !== null ? ' /* 수동 설정 */' : ` /* 자동: ${m.col}/${desktopColumns} × ${targetColumns} = ${mobileSpan} */`;
      
      return `  .module-${moduleClassIndex} {
    grid-column: span ${mobileSpan};${comment}
    grid-row: span ${m.row};
    order: ${i};
  }`;
    }).join('\n\n');
  } 

  css += '\n}';
  return css;
}

function updateCode() {
  document.getElementById('code-display').textContent = activeTab === 'html' ? generateHTML() : generateCSS();
}

function switchTab(tab, event) {
  activeTab = tab;
  document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  updateCode();
}

function copyCode() {
  navigator.clipboard.writeText(activeTab === 'html' ? generateHTML() : generateCSS());
  showToast(`${activeTab.toUpperCase()} 코드 복사됨!`);
}

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.style.display = 'block';
  setTimeout(() => toast.style.display = 'none', 3000);
}

window.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
